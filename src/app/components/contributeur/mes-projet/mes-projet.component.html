<div class="grid-projets">
  @for (proj of projets; track $index) {
  <article class="projet-card">
    <div class="head">
      <h3 class="title">{{ proj?.titre }}</h3>
      <div class="tags">
        <span class="tag">{{ proj.dommaine || 'Domaine' }}</span>
        <span class="tag soft">{{ proj.niveauDAcces || 'Accès' }}</span>
      </div>
    </div>

    <p class="desc">
      {{ proj.description | slice:0:140 }}{{ proj.description?.length > 140 ? '…' : '' }}
    </p>

    <div class="meta">
      <span><i class="ri-user-3-line"></i>
        Gestionnaire :
        <b>
          {{ proj.gestionnaire?.prenom | slice:0:1 }}{{ proj.gestionnaire?.prenom?.length > 1 ? '.' : '' }}
          {{ proj.gestionnaire?.nom }}
        </b>
      </span>
      <span><i class="ri-calendar-line"></i> Début : {{ proj.dateDebut | date:'dd/MM/yyyy' }}</span>
      <span><i class="ri-heart-2-line"></i> Soutiens : {{ proj.nombreSoutiens || 0 }}</span>
    </div>

    <div class="actions">
      <button class="btn-primary" (click)="openDetail(proj)">
        <i class="ri-eye-line"></i> Détails
      </button>
      <!-- <button class="btn-primary" (click)="openDemande(proj)">
        <i class="ri-send-plane-line"></i> Contribuer
      </button> -->
    </div>
  </article>
  }
</div>

<!-- MODAL DÉTAIL PROJET -->
<div class="modal" [class.open]="showDetail">
  <div class="contenu" role="dialog" aria-modal="true" aria-labelledby="modalDetailTitle">
    <div class="modal-header">
      <h3 id="modalDetailTitle">Détails du projet</h3>
      <button class="btn-icon close" aria-label="Fermer" (click)="closeDetail()">
        <i class="ri-close-line"></i>
      </button>
    </div>

    <div class="modal-body grid-two">
      <div class="bloc">
        <h4 class="sub">Informations</h4>
        <div class="kv"><span class="k">Titre</span><span class="v">{{ selected?.titre }}</span></div>
        <div class="kv"><span class="k">Domaine</span><span class="v">{{ selected?.dommaine }}</span></div>
        <div class="kv"><span class="k">Niveau d’accès</span><span class="v">{{ selected?.niveauDAcces }}</span></div>
        <div class="kv"><span class="k">Début</span><span class="v">{{ selected?.dateDebut | date:'dd/MM/yyyy' }}</span></div>
      </div>

      <div class="bloc">
        <h4 class="sub">Gestionnaire</h4>
        <div class="kv"><span class="k">Nom</span><span class="v">
          {{ selected?.gestionnaire?.prenom }} {{ selected?.gestionnaire?.nom }}
        </span></div>
        <div class="kv"><span class="k">Contacts</span><span class="v">{{ selected?.gestionnaire?.email || '—' }}</span></div>

        <h4 class="sub mt">Statistiques</h4>
        <div class="stats-inline">
          <div class="pill"><i class="ri-heart-2-line"></i> {{ selected?.nombreSoutiens || 0 }} soutiens</div>
          <div class="pill"><i class="ri-time-line"></i> {{ selected?.etat || 'EN_COURS' }}</div>
        </div>
      </div>

      <div class="bloc span-2">
        <h4 class="sub">Description</h4>
        <p class="desc-long">{{ selected?.description }}</p>
      </div>
    </div>

    <div class="modal-actions">
      <button class="btn-secondary" (click)="closeDetail()">Fermer</button>
      <!-- <button class="btn-primary" (click)="openDemande(selected)">
        <i class="ri-send-plane-line"></i> Demander à contribuer
      </button> -->
    </div>
  </div>
</div>

<!-- MODAL DEMANDE DE CONTRIBUTION -->
<div class="modal" [class.open]="showDemande">
  <div class="contenu" role="dialog" aria-modal="true" aria-labelledby="modalDemandeTitle">
    <div class="modal-header">
      <h3 id="modalDemandeTitle">Demande de contribution</h3>
      <button class="btn-icon close" aria-label="Fermer" (click)="closeDemande()">
        <i class="ri-close-line"></i>
      </button>
    </div>

    <div class="modal-body">
      <div class="ligne">
        <label>Projet</label>
        <input type="text" [value]="selected?.titre" disabled>
      </div>

      <div class="ligne duo">
        <div>
          <label>Profil souhaité</label>
          <select [(ngModel)]="profileContributeur">
            <option value="DEV_FULLSTACK">Développeur FULLSTACK</option>
            <option value="DEV_MOBILE">Développeur Mobile</option>
            <option value="DEV_FRONT_END">Développeur Frontend</option>
            <option value="DESIGNER">Designer UI/UX</option>
            <option value="TESTER">QA / Test</option>
            <option value="DEV_OPS">DevOps</option>
          </select>
        </div>
        <div>
          <label>Disponibilité (heures/sem.)</label>
          <input type="number" [(ngModel)]="disponibilite" placeholder="ex: 10">
        </div>
      </div>

      <div class="ligne">
        <label>Message au gestionnaire</label>
        <textarea rows="4" [(ngModel)]="message"
          placeholder="Présente ton profil, ta dispo, et ce que tu veux apporter…"></textarea>
      </div>
    </div>

    <div class="modal-actions">
      <button class="btn-secondary" (click)="closeDemande()">Annuler</button>
      <!-- <button class="btn-primary" (click)="envoyerDemande(selected?.id)">
        <i class="ri-send-plane-line"></i> Envoyer la demande
      </button> -->
    </div>
  </div>
</div>

